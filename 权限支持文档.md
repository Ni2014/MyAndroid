## 对Android6.0的支持

Android6.0中对特定的权限进行了动态授权的方式，需要在运行时用户手动授予，如果用户拒绝后再次申请还可以向用户弹框说明权限的作用，用户点击确认后再去申请。申请权限的代码如下：

    private static final int REQUEST_CODE_CAMERA = 1;
    if(ContextCompat.checkSelfPermission(MainActivity.this, Manifest.permission.CAMERA)!= PackageManager.PERMISSION_GRANTED){
        ActivityCompat.requestPermissions(MainActivity.this,new String[]{Manifest.permission.CAMERA},REQUEST_CODE_CAMERA);
    }

	
写好后还要覆写onRequestPermissionsResult方法，去处理权限申请回调

  	
	@Override
    public void onRequestPermissionsResult(int requestCode,String[] permissions,int[] grantResults){
        switch (requestCode){
            case REQUEST_CODE:
                // 得到的结果集grantResults[] 下标位置根据自己传的权限
                if (grantResults.length > 0
                       && grantResults[0] == PackageManager.PERMISSION_GRANTED){
                    // 授权了
                    Toast.makeText(MainActivity.this,"granted",Toast.LENGTH_LONG).show();
                }else{
                   Toast.makeText(MainActivity.this,"denied",Toast.LENGTH_LONG).show();
                }
                return;
        }
    }

	


如果每次需要权限就要写申请权限的代码和对返回的结果集做判断是有点繁琐的，所以，SDK新增了一个支持Android6.0权限管理的工具类PermissionManager，具体使用如下：

1.构建PermissionManager对象

	PermissionManager helper;
	helper = PermissionManager.with(MainActivity.this)
                        .addRequestCode(MainActivity.REQUEST_CODE_CAMERA)
                        .permissions(Manifest.permission.CAMERA)
                        .setPermissionsListener(new PermissionListener() {
                            @Override
                            public void onGranted() {
                               Toast.makeText(MainActivity.this, "granted",Toast.LENGTH_LONG).show();
                            }

                            @Override
                            public void onDenied() {
                               Toast.makeText(MainActivity.this, "denied",Toast.LENGTH_LONG).show();
                            }

                            @Override
                            public void onShowRationale(String[] permissions) {
                                // 可以弹出对话框解释为什么需要权限
                                Snackbar.make(btn_camera, "需要相机权限去拍照", Snackbar.LENGTH_INDEFINITE)
                                        .setAction("ok", new View.OnClickListener() {
                                            @Override
                                            public void onClick(View v) {
												// 不要忘了
                                                helper.setIsPositive(true);
                                                helper.request();
                                            }
                                        }).show();
                            }
                        }).request();


注：

- with()方法可以传入Activity或者Fragment；
- addRequestCode()方法传入请求码，方便后面的回调；
- permissions()方法传入的是你所要请求的权限，支持可变参数，可以批量申请权限；
- PermissionListener接口回调的三个方法，onGranted()会在权限申请通过后被调用，onDenied()在申请被拒绝时被调用，在onShowRationale()方法中你可以弹对话框向用户解释权限的作用，不过记得要调用setIsPositive(true);
- 调用reques()方法申请权限；

2.覆写onRequestPermissionsResult方法

	@Override
    public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
        switch (requestCode) {
            case REQUEST_CODE_CAMERA:
                helper.onPermissionResult(permissions, grantResults);
                break;
        }

    }


	


