#《Android开发艺术探索》读书笔记
#第十一章 Android的线程和线程池
	(1)除了Thread外，在Android中可以扮演线程角色的还有很多，比如AsyncTask和IntentService，同时HandlerThread也是一种特殊的线程。AsyncTask底层用到了线程池，IntentService和HandlerThread底层直接用了线程。<br>
	不同形态的线程有不同的特性和使用场景。<br>
	AsyncTask封装了线程池和Handler，主要是为了方便开发者在子线程中去更新UI。<br>
	HandlerThread是一种具有消息循环的线程，在它的内部可以用Handler。<br>
	IntentService是一个服务，系统对他进行了封装使其可以更方便执行后台任务，内部采用了HandlerThread来执行任务，任务执行完后IntentService会自动退出。从任务执行的角度看，IntentService的作用很像一个后台线程，但是IntentService是一种服务，他不容易被系统杀死并可以尽量保证任务的执行，而如果仅仅是个后台线程的话，因为此时线程中没有活动的四大组件，那么这个进程的优先级会变得很低，很容易被系统杀死，这就是IntentService的优点；<br>
	(2)线程池的引入<br>
	频繁创建和销毁线程会有很大的开销，所以采用线程池，一个线程池中会缓存一定数量的线程，避免频繁创建和销毁线程带来的系统开销。Android中的线程池来源于java，主要通过Executor来派生特定类型的线程池，不同种类的线程池有不同的特性。<br>
##11.1 主线程和子线程
	主线程是指进程拥有的线程，在java中默认情况下一个进程只有一个线程，这个线程就是主线程，作用是运行四大组件以及处理他们和用户的交互。<br>
	子线程也叫工作线程，作用是执行耗时的任务，Android3.0开始系统要求网络访问必须在子线程中进行，这就是为了避免ANR；<br>
##11.2 Android中的线程形态
	除了Thread以外，还包含AsyncTask，HandlerThread以及IntentService，后三者的底层实现也是线程。为了简化在子线程中访问UI的过程，系统提供了AsyncTask，经过几次修改，导致了对于不同的API版本AsyncTask有不同的实现；<br>
11.2.1 AsyncTask<br>
	1.是轻量级的异步任务类，但是不适用于执行特别耗时的后台任务，特别耗时的建议用线程池；<br>
	AsyncTask是一个抽象的泛型类，提供了Params，Progress和Result三个泛型参数，Params表示参数的类型，Progress表示后台执行任务的进度，而Result表示后台执行任务返回的结果的类型，不需要就用Void代替，四个核心方法：<br>
	(1)onPreExecute(),在主线程执行，在异步任务执行前会被调用，一般做一些准备工作；<br>
	(2)doInBackground(Params...params)，在线程池中执行，用于执行异步任务，在这个方法中可以通过publishProgress方法来更新任务的进度，publishProgress方法会调用onProgressUpdate方法，另外该方法需要返回计算结果给onPostExecute方法；<br>
	(3)onProgressUpdate(Progress result)，在主线程执行，当后台任务的执行进度发生改变时该方法会被调用；<br>
	(4)onPostExecute(Result result)，在主线程中执行，在异步任务完成后该方法会被调用，result参数是后台任务的返回值，即doInBackground的返回值；<br>
	除了这四个方法外，还提供了onCancelled方法，同样在主线程中执行，异步任务被取消时，这个方法会被调用，这个时候onPostExecute就不会被调用；<br>
	2.在具体使用中的一些限制<br>
	(1)AsyncTask的类必须在主线程中被加载，意味着第一次访问AsyncTask必须发生在主线程，当然这个过程在Android4.1及以上的版本中已经被系统自动完成，在5.0的源码中，查看ActivityThread的main方法，会调用AsyncTask的init方法，这就满足了AsyncTask的类必须在主线程中进行加载这个条件了；<br>
	(2)AsyncTask的对象必须在主线程中创建；<br>
	(3)execute方法必须在主线程中调用；<br>
	(4)不要在程序中直接调用那四个方法；<br>
	(5)一个AsyncTask对象只能执行一次，即只能调用一次execute方法，否则会报异常；<br>
	(6)在Android1.6之前，AsyncTask是串行执行的，1.6时开始采用线程池处理并行任务，但是3.0开始，为了避免AsyncTask带来的并发错误，AsyncTask又采用了一个线程来串行执行任务，尽管如此，在3.0之后的版本中，仍然可以通过executeOnExecutor方法来并行执行任务；<br>
11.2.2 AsyncTask的工作原理<br>
	从execute方法开始分析，它又调用了executeOnExecutor方法
11.2.3 HandlerThread<br>
11.2.4 IntentService<br>

	
##11.3 Android中的线程池